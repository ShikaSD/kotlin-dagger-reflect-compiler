plugins {
    id 'org.jetbrains.kotlin.jvm'
    id 'idea'
}

dependencies {
    implementation deps.kotlin.stdlib
    implementation deps.dagger.runtime
    implementation deps.dagger.reflect

    kotlinCompilerPluginClasspath project(':compiler:compiler-plugin')
}

tasks.withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompile).all { it ->
    def sourcesDir = new File(buildDir, "kotlin/${it.name}/generated/")
    sourcesDir.mkdirs()

    idea.module.sourceDirs += sourcesDir
    idea.module.generatedSourceDirs += sourcesDir

    kotlinOptions {
        freeCompilerArgs = [
            "-P",
            "plugin:me.shika.dagger-reflect:outputDir=${sourcesDir.getAbsolutePath()}"
        ]
    }
}

compileKotlin {
    kotlinOptions.jvmTarget = "1.8"
}
compileTestKotlin {
    kotlinOptions.jvmTarget = "1.8"
}
